<template>
<!-- <<<<<<< HEAD
  <div class="toss-detail-container">
    í˜ë¥´ì†Œë‚˜ ì •ì˜ -->
    <!-- <section class="user-persona-card">
      <div class="persona-icon">{{ accountStore.financial_profile.icon }}</div>
      <div class="persona-info">
        <span class="persona-tag">{{ accountStore.financial_profile.tag }}</span>
        <h2 class="persona-title">{{ userName }}ë‹˜ì€ <br/>{{ accountStore.financial_profile.title }}</h2>
        <p class="persona-desc">{{ accountStore.financial_profile.description }}</p> -->

  <div class="analysis-container">
    <section class="analysis-summary-grid">
      <div class="summary-card">
        <h3>ë‚˜ì˜ ì†Œë¹„ DNA</h3>
        <div class="dna-item">
          <span class="dna-label">ì‹ë¹„/ë°°ë‹¬</span>
          <div class="dna-bar-bg"><div class="dna-bar-fill" style="width: 80%"></div></div>
        </div>
        <p class="dna-nudge">"ë‹¬ì½¤í•œ ê°„ì‹ì—ëŠ” ì§„ì‹¬ì´ì‹œêµ°ìš”! ì»¤í”¼ í• ì¸ ì¿ í°ì„ ì£¼ëŠ” ìƒí’ˆì´ ë”±ì´ì—ìš”."</p>
      </div>
      
      <div class="summary-card">
        <h3>í‰ê·  ì €ì¶•ë¥  ë¶„ì„</h3>
        <div class="rate-comparison">
          <div class="my-rate">ë‚˜ ({{ currentCluster.tag }}) <strong>22%</strong></div>
          <div class="avg-rate">ë˜ë˜ í‰ê·  <strong>12%</strong></div>
        </div>
        <div class="coach-mark">ğŸ’¡ <strong>ê¿€íŒ:</strong> ì €ì¶• ì—¬ë ¥ì´ ë†’ìœ¼ì‹œë„¤ìš”! ë‹¨ê¸° ìƒí’ˆë³´ë‹¤ëŠ” ê¸ˆë¦¬ê°€ ë†’ì€ <strong>ì •ê¸°ì ê¸ˆ</strong>ì„ ì¶”ì²œí•´ìš”.</div>
      </div>
    </section>

    <section class="recommend-ranking-section">
      <h2 class="ranking-title">
        {{ userName }}ë‹˜ê³¼ ë¹„ìŠ·í•œ ì„±í–¥ì˜ ë¶„ë“¤ì€ <span class="blue-text">72%</span>ë‚˜ ê°€ì…í–ˆì–´ìš”!
      </h2>

      <div class="ranking-cards">
        <div v-if="recommendations[1]" class="side-card rank-2">
          <span class="rank-badge">2ìœ„</span>
          <p class="bank-name">{{ recommendations[1].kor_co_nm }}</p>
          <h4 class="prod-name">{{ recommendations[1].fin_prdt_nm }}</h4>
          <div class="main-rate">{{ recommendations[1].intr_rate2 }}%</div>
          <button class="small-view-btn">ìì„¸íˆ ë³´ê¸°</button>
        </div>

        <div v-if="recommendations[0]" class="main-card rank-1">
          <div class="crown-icon">ğŸ‘‘ 1ìœ„</div>
          <p class="bank-name">{{ recommendations[0].kor_co_nm }}</p>
          <h3 class="prod-name">{{ recommendations[0].fin_prdt_nm }}</h3>
          
          <div class="rate-display">
            <span class="big-rate">{{ recommendations[0].intr_rate2 }}%</span>
            <span class="rate-sub">ìµœê³  ê¸ˆë¦¬ (ì—°)</span>
          </div>
          
          <div class="prod-tags">
            <span>{{ recommendations[0].save_trm }}ê°œì›” ë§Œê¸°</span>
            <span>ì •ì•¡ì ë¦½ì‹</span>
          </div>

          <button class="apply-btn">ê°€ì…í•˜ëŸ¬ ê°€ê¸° â†’</button>
        </div>

        <div v-if="recommendations[2]" class="side-card rank-3">
          <span class="rank-badge">3ìœ„</span>
          <p class="bank-name">{{ recommendations[2].kor_co_nm }}</p>
          <h4 class="prod-name">{{ recommendations[2].fin_prdt_nm }}</h4>
          <div class="main-rate">{{ recommendations[2].intr_rate2 }}%</div>
          <button class="small-view-btn">ìì„¸íˆ ë³´ê¸°</button>
        </div>
      </div>
    </section>
<!-- 
      <div class="button-group">
        <button class="toss-btn-blue" @click="goOptionApply(rec.product_option_id)">ì‹ ì²­í•˜ê¸°</button> -->
    <section v-if="recommendations[0]" class="ai-deep-analysis">
      <div class="analysis-header">
        <span class="sparkle-icon">âœ¨</span>
        <h3>1ìœ„ ìƒí’ˆ, ì™œ ì¶”ì²œë˜ì—ˆì„ê¹Œìš”?</h3>
      </div>

      <div class="analysis-grid">
        <div class="analysis-box reason-box">
          <p class="box-label">ì‚¬ìš©ìë‹˜ì„ ìœ„í•œ AI ë¶„ì„ í¬ì¸íŠ¸</p>
          <ul class="point-list">
            <li>âœ… {{ recommendations[0].ai_analysis?.reason || 'ìì¶• ì—¬ë ¥ì´ ë†’ì€ í¸ì´ë¼ ë‹¨ê¸° ê³ ê¸ˆë¦¬ ìƒí’ˆì— ìœ ë¦¬í•´ìš”.' }}</li>
            <li>âœ… {{ recommendations[0].ai_analysis?.nudge || 'ìœ ì‚¬ ìƒí’ˆêµ° ëŒ€ë¹„ ê¸ˆë¦¬ê°€ 0.5%p ë” ë†’ì•„ìš”.' }}</li>
          </ul>
        </div>

        <div class="analysis-box group-box">
          <p class="box-label">ìœ ì‚¬ ê·¸ë£¹ ë¶„ì„</p>
          <div class="group-text">
            {{ userName }}ë‹˜ê³¼ ë¹„ìŠ·í•œ <strong>ì†Œë“ ìˆ˜ì¤€ ìƒìœ„ 30%</strong> ê·¸ë£¹ì˜ 
            <span class="yellow-text">72%</span>ê°€ ì´ ìƒí’ˆì— ê°€ì…í–ˆì–´ìš”!
          </div>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { onMounted } from 'vue'
import { useAccountStore } from '@/stores/accounts';

const router = useRouter()
const accountStore = useAccountStore()

// 1. í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ë‹´ì„ ë°˜ì‘í˜• ë³€ìˆ˜ (ì´ˆê¸° ì—ëŸ¬ ë°©ì§€ìš© ë¹ˆ ê°ì²´)
const currentCluster = ref({
  tag: 'ë¶„ì„ ì¤‘...',
  title: '',
  icon: '',
  description: ''
})

const props = defineProps({
  isMyData: Boolean,
  userName: { type: String, default: 'ì‚¬ìš©ì' },
  cluster: { type: [Number, String], default: 0 }, // ğŸŸ¢ ë¶€ëª¨ë¡œë¶€í„° í´ëŸ¬ìŠ¤í„° ë²ˆí˜¸ ìˆ˜ì‹ 
  // ë¶€ëª¨ë¡œë¶€í„° ë°›ì€ ì‹¤ì œ ì¶”ì²œ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
  recommendations: {
    type: Array,
    default: () => []
  }
})

// í´ëŸ¬ìŠ¤í„° ì •ì˜
// clusterMapper.js ë˜ëŠ” ResultsStepItem.vue ë‚´ë¶€
// const clusterMapper = {
//   0: {
//     title: "ì„±ì‹¤í•˜ê²Œ ëª¨ìœ¼ëŠ” ì €ì¶•ì™•",
//     tag: "ì•ˆì •ì €ì¶•í˜•",
//     icon: "ğŸŒ±",
//     description: "ì†Œë“ ëŒ€ë¹„ ì†Œë¹„ë¥¼ ì˜ ê´€ë¦¬í•˜ë©° ê¾¸ì¤€íˆ ìì‚°ì„ ìŒ“ì•„ê°€ê³  ê³„ì‹œë„¤ìš”!"
//   },
//   1: {
//     title: "í˜„ì¬ì˜ í–‰ë³µì´ ì¤‘ìš”í•œ ìšœë¡œì¡±",
//     tag: "ì†Œë¹„ì¤‘ì‹¬í˜•",
//     icon: "ğŸŒˆ",
//     description: "ì§€ì¶œ ë¹„ì¤‘ì´ ë‹¤ì†Œ ë†’ì§€ë§Œ, ì§€ê¸ˆë¶€í„° ì¡°ê¸ˆì”© ë¯¸ë˜ë¥¼ ìœ„í•œ ì¤€ë¹„ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”?"
//   },
//   2: {
//     title: "í˜„ê¸ˆì„ ë“ ë“ í•˜ê²Œ ë³´ìœ í•œ í™€ë”",
//     tag: "í˜„ê¸ˆë³´ìœ í˜•",
//     icon: "ğŸ¦",
//     description: "ìì‚°ì˜ ìœ ë™ì„±ì´ ë§¤ìš° ì¢‹ìœ¼ì‹œë„¤ìš”. ì´ì œ ë” ë†’ì€ ê¸ˆë¦¬ì˜ ìƒí’ˆìœ¼ë¡œ ëˆˆì„ ëŒë¦´ ë•Œì…ë‹ˆë‹¤."
//   },
//   3: {
//     title: "ì—¬ìœ ë¡œìš´ ìì‚° ê´€ë¦¬ ì „ë¬¸ê°€",
//     tag: "ìì‚°ê´€ë¦¬í˜•",
//     icon: "ğŸ’¼",
//     description: "ë†’ì€ ì†Œë“ê³¼ ì² ì €í•œ ì§€ì¶œ ê´€ë¦¬ë¡œ ê°€ì¥ ì´ìƒì ì¸ ê¸ˆìœµ ìƒí™œì„ í•˜ê³  ê³„ì‹­ë‹ˆë‹¤."
//   },
//   4: {
//     title: "ìˆ˜ìµì„ ì«“ëŠ” ê³µê²©ì  íˆ¬ìì",
//     tag: "ê³µê²©íˆ¬ìí˜•",
//     icon: "ğŸš€",
//     description: "ìì‚°ì˜ ëŒ€ë¶€ë¶„ì„ ì ê·¹ì ìœ¼ë¡œ ìš´ìš©í•˜ì‹œëŠ”êµ°ìš”. ê³ ìˆ˜ìµì„ ìœ„í•œ ìµœì ì˜ ìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤."
//   }
// };

// ğŸŸ¢ í´ëŸ¬ìŠ¤í„° ë°ì´í„° ë§¤í•‘
// const currentCluster = computed(() => {
//   return clusterMapper[props.cluster] || clusterMapper[0];
// })

// // ê°€ì¥ ì ìˆ˜ê°€ ë†’ì€ ì²« ë²ˆì§¸ ìƒí’ˆì„ ë©”ì¸ìœ¼ë¡œ ë…¸ì¶œ
// const mainProduct = computed(() => {
//   return props.recommendations[0] || {}
// })

// const analysisSummary = computed(() => {
//   return props.isMyData 
//     ? 'í˜„ì¬ ë³´ìœ í•˜ì‹  ìì‚° í˜„í™©ê³¼ ì§€ì¶œ íŒ¨í„´ì„ ê³ ë ¤í•˜ì—¬ ì„ ì •í–ˆìŠµë‹ˆë‹¤.'
//     : 'ë‹µë³€í•˜ì‹  ê°€ì… ëª©ì ê³¼ ì„ í˜¸ ê¸°ê°„ì„ ë°”íƒ•ìœ¼ë¡œ ì„ ì •í–ˆìŠµë‹ˆë‹¤.'
// })

// const handleReAuth = () => {
//   console.log('Redirecting to MyData Auth...')
// }

const goOptionApply = (id) => {
  if (id) router.push({ name: 'Subscribe', params: { id: id } })
}
// 2. ë°±ì—”ë“œì˜ getClusterInfoë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
const fetchClusterData = async () => {
  try {
    const res = await axios.get(`${accountStore.API_URL}/ì´ë¯¸_ì„¤ì •ëœ_ê²½ë¡œ/getClusterInfo/`, {
      headers: { Authorization: `Token ${accountStore.token}` }
    })
    if (res.data && res.data.tag) {
      currentCluster.value = res.data // ë°±ì—”ë“œì—ì„œ ì¤€ {tag, title, icon...} ê°€ ì €ì¥ë¨
    }
  } catch (err) {
    console.error('í´ëŸ¬ìŠ¤í„° ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', err)
  }
}

onMounted(async () => {
  // í´ëŸ¬ìŠ¤í„° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  await fetchClusterData()
  // ê¸°ì¡´ í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
  await accountStore.getFinancialProfile()
})

// onMounted(async () => {
//   await Promise.all([
//     accountStore.getFinancialProfile()
//   ])
// })

// ì¶”ì²œ ì‹ ë¢°ë„ì— ë”°ë¼ CSS í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
const getConfidenceClass = (confidence) => {
  if (confidence >= 0.7) return 'conf-high';
  if (confidence >= 0.4) return 'conf-medium';
  return 'conf-low';
};
</script>

<style scoped>
.analysis-container { background-color: #fff9e6; padding: 20px; font-family: 'Pretendard', sans-serif; }

/* ìƒë‹¨ ë¶„ì„ ì¹´ë“œ */
.analysis-summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 30px; }
.summary-card { background: #fff; padding: 20px; border-radius: 20px; border: 1px solid #fee500; }
.summary-card h3 { font-size: 16px; margin-bottom: 15px; color: #333; }
.dna-bar-bg { height: 10px; background: #eee; border-radius: 5px; margin: 10px 0; }
.dna-bar-fill { height: 100%; background: #ffcc00; border-radius: 5px; }

/* ë­í‚¹ ì„¹ì…˜ */
.ranking-title { text-align: center; font-size: 18px; margin-bottom: 24px; font-weight: 700; }
.blue-text { color: #3182f6; }
.ranking-cards { display: flex; align-items: flex-end; justify-content: center; gap: 10px; margin-bottom: 40px; }

/* 1ìœ„ ì¹´ë“œ ê°•ì¡° */
.main-card { 
  background: #fff; border: 3px solid #ffcc00; padding: 30px 20px; border-radius: 24px;
  width: 200px; text-align: center; box-shadow: 0 10px 20px rgba(255, 204, 0, 0.2);
  z-index: 2;
}
.big-rate { font-size: 40px; font-weight: 800; color: #ff9900; display: block; }
.apply-btn { background: #332211; color: #fff; border: none; padding: 12px 20px; border-radius: 12px; margin-top: 20px; width: 100%; font-weight: 700; cursor: pointer;}

/* 2, 3ìœ„ ì¹´ë“œ */
.side-card { 
  background: #fff; border: 1px solid #ddd; padding: 20px 15px; border-radius: 20px;
  width: 150px; text-align: center; height: 220px; opacity: 0.9;
}
.main-rate { font-size: 24px; font-weight: 700; color: #555; margin: 10px 0; }
.small-view-btn { background: #f2f4f6; border: none; padding: 8px 12px; border-radius: 10px; font-size: 12px; width: 100%; }

/* í•˜ë‹¨ AI ë¶„ì„ ë¦¬í¬íŠ¸ */
.ai-deep-analysis { background: #fff; border-radius: 24px; padding: 24px; border: 1px solid #eee; }
.analysis-header { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; }
.analysis-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 16px; }
.analysis-box { padding: 20px; border-radius: 18px; }
.reason-box { background: #f0f4ff; }
.group-box { background: #6333ff; color: #fff; }
.point-list { list-style: none; padding: 0; margin-top: 10px; }
.point-list li { margin-bottom: 8px; font-size: 14px; color: #333; }
.yellow-text { color: #ffeb3b; font-weight: 700; }
</style>